<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Peasant and The Dragon</title><!-- !!Change this excuse for a title at some point!! -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Make the nav menu slide out */
        body {
        transition: margin-left 0.3s;
        }

        /* Top margin bar */
        #topbar {
        height: 50px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background-color: #f8f9fa;
        border-bottom: 1px solid #ddd;
        z-index: 999;
        display: flex;
        align-items: center;
        padding: 0 1rem;
        }

        /* Sidebar layout */
        #mySidebar {
        width: 0;
        height: 100%;
        position: fixed;
        z-index: 998;
        top: 50px;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        padding-top: 20px;
        transition: 0.3s;
        }

        #mySidebar a {
        padding: 10px 20px;
        text-decoration: none;
        font-size: 18px;
        color: #f1f1f1;
        display: block;
        }

        #mySidebar a:hover {
        background-color: #575757;
        }

        /* Main content area */
        #main {
        margin-left: 0;
        margin-top: 70px;
        padding: 20px;
        transition: margin-left 0.3s;
        }

        .story-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        text-align: left;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }

        .choice-box a {
        display: block;
        text-align: left;
        margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Top Banner and menu toggle -->
    <div id="topbar">
        <button id="menuToggle" class="btn btn-dark me-3">☰</button>
        <span class="text-muted">Adventure Menu</span>
    </div>

    <!-- Slide-out Sidebar Navigation -->
    <div id="mySidebar">
        <a href="index.html">Main Menu</a>
        <a href="#">Settings</a>
    </div>

    <!-- Main Story Display Area -->
    <div id="main">
        <h1>The Peasant and The Dragon</h1>
        <div id="story" class="story-box my-4"></div>
        <div id="choices" class="choice-box"></div>
        <!-- Temporary karma display until I decide on a better method -->
        <div id="karmaDisplay" class="mt-4"><strong>Karma:</strong> <span id="karma">0</span></div>
    </div>

    <!-- The Story -->
    <script>
        const storyData = {
            intro: {
                text: "The crown jewel of the kingdom, positioned on several important trade routes with fertile land stretching for miles in every direction, few cities could compare. That was until the dragon came. It had been months now, hundreds of knights and self-proclaimed 'brave men' had perished in their attempts to rid the cave under the city of the dragon that had taken up nesting there. There had been many in the first weeks, but the majority of the fools were gone now and most of those who attempted to slay the beast were of the desperate kind, indebted gamblers or brigands with little to lose. At a glance, Skuba fit none of these archetypes, inheriting a small farmstead from his late father this close to the capital provided him with the sort of sustainability most farmers and peasants could only dream of. Nor was he particularly troubled by the now defunct trade route; his farms annual output easily covered by the increasing demand for grain now that most of the livestock in the surrounding area was long gone. Perhaps this made him yet another simple fool, throwing his life away for nothing, was he hoping to claim the opportunity to climb the feudal ladder? To show that he was made for bigger things than sowing and reaping grain every year? Nobody knew, perhaps not even him.",
                options: [
                { text: "Regardless of his motivation, there were immediate decisions he had to make.", next: "start", karma: 0 }
                ]
            },
            start: {
                text: "Skuba had been pretty content with living his life. Even the dragon moving in under the castle wasn't particularly threatening to his wellbeing as long as it wasn't especially hungry. Due to the initial number of livestock and foolhardy challengers, the dragon was rarely especially hungry.",
                options: [
                { text: "Go check if the dragon is asleep", next: "check", karma: 0 },
                { text: "Go inform the king of your idea", next: "king", karma: +2 },
                { text: "Make a plan before acting", next: "plan", karma: 0 }
                ]
            },
            check: {
                text: "The dragon was not in fact asleep...",
                options: [
                { text: "What did you expect?", next: "start", karma: 0 }
                ]
            },
            king: {
            text: "As a measure of caution, Skuba thought to warn the king directly. If the dragon ever left the cave, agitated, the palace itself would be in danger. The court mostly mocked the peasant’s seemingly foolish idea, but the king listened. A few guards were moved, a few windows reinforced. It may not have mattered. But it might have. Skuba left, empty-handed — but not unacknowledged.",
            options: [
                { text: "Return home to think things through", next: "plan", karma: 0 }
                ]
            },
            plan: {
                text: "Skuba was not particularly brave, nor was he eager to visit his ancestors. But he was methodical. If legends were anything to go by, dragons were gluttonous, arrogant, and above all, predictable. He consulted a local alchemist regarding his idea. If it didn’t work, well — it was better than charging into an angry furnace.",
                options: [
                    { text: "Recruit help and gather materials", next: "organise", karma: 0 }
                ]
            },
            organise: {
                text: "The fighting spirit of the first few weeks had long died down, but the promise of coin or glory still held sway over a few remaining locals. A little bit of persuasion, bluffing, and strategic invoking of royal support, and Skuba managed to scrape together enough hands and materials to give his scheme an honest shot.",
                options: [
                    { text: "Use bait to lure the dragon into a trap", next: "lure", karma: 0 }
                ]
            },
            lure: {
                text: "The plan was simple. A sheep carcass, stuffed with sulfur and pitch, hopefully enough to fool the gluttonous moster. Not particularily honourable but honour went both ways and the dragon had proven to not be acquainted with the concept. But someone needed to place the lure near to the cave, close enough to tempt the beast.",
                options: [
                    { text: "Have someone else deliver the bait", next: "friend", karma: -1 },
                    { text: "Do it yourself", next: "self", karma: +1 }
                ]
            },
            friend: {
                text: "",
                options: [
                    { text: "Try again. Maybe better this time.", next: "start", karma: 0 }
                ]
            },
            self: {
            text: "",
            options: [
                { text: "Restart the story", next: "start", karma: 0 }
                ]
            }
        };

        let currentScene = "intro";
        let karma = 0;
        
        // Dynamic webpage
        function renderScene(sceneId) {
            const sidebar = document.getElementById("mySidebar");
            if (sidebar.style.width === "") sidebar.style.width = "0";

            // Find current scene
            const scene = storyData[sceneId];
            currentScene = sceneId;

            // Endings based on karma, this is going to get unmaintanable.
            let displayText = scene.text;
            if (sceneId === "self" && karma >= 2) {
                displayText = "The smell of sulfur nearly gagged Skuba on the walk. He placed the lure at the cave mouth and retreated. The dragon fell for it completely. The explosion tore through the mountain and silence followed. The people called him not a fool, but a savior. For once, the songs might be true.";
            } else if (sceneId === "self") {
                displayText = "The dragon exploded, yes. But so did the entire lower market. Nobody blamed Skuba to his face, the dragon was gone after all, but there was little celebration for the one who arguably caused more damage than the beast had. Just the quiet knowledge that sometimes, winning doesn't feel like it.";
            } else if (sceneId === "friend" && karma >= 1) {
                displayText = "Skuba's friend braved the drop-off and set the bait perfectly. The dragon took it, and though the blast shook the hills, the brave volunteer returned — burned, limping, but alive. Skuba and the rest of the conspirators carried him back together. It wasn’t a perfect win, but it was enough. It was never really about the glory.";
            } else if (sceneId === "friend") {
                displayText = "The poor soul who took the bait didn't come back. The dragon did, not dead, but notably less threatening than before. It fled the cave the next day, wings half-burned. The town was saved and the expected celebrations ensued, it did little to soothe the guilt.";
            }

            document.getElementById("story").innerHTML = displayText
            document.getElementById("choices").innerHTML = "";

            // Loop through each option
            scene.options.forEach(option => {
                // Create the button for each option
                const a = document.createElement("a");
                // Shrodringers hyperlink
                a.href = "#";
                a.className = "btn btn-outline-primary";
                a.innerText = option.text;
                // Make the buttons work with karma
                a.onclick = () => {
                    if (option.next === "intro" || option.next === "start") {
                    karma = 0; // Reset karma on new attempt (start & restart)
                    } else {
                    karma += option.karma;
                    }
                    // Update the temporary karma field
                    document.getElementById("karma").innerText = karma;
                    // Go again
                    renderScene(option.next);
                };
                // Add the button to the choice box
                document.getElementById("choices").append(a);
            });
        }
            
        // Sidebar toggle
        let sidebarOpen = false;
        document.getElementById("menuToggle").onclick = function () {
            const sidebar = document.getElementById("mySidebar");
            const main = document.getElementById("main");

            if (sidebarOpen) {
                sidebar.style.width = "0";
                main.style.marginLeft = "0";
            } else {
                sidebar.style.width = "250px";
                main.style.marginLeft = "250px";
            }
            sidebarOpen = !sidebarOpen;
        };
        
        // Load the first scene
        window.onload = () => {
            renderScene(currentScene);
        };

    </script>

</body>
</html>
