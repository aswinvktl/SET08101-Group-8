<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>a strong companion</title>

  <!-- global settings and styles -->
  <script src="../js/globalSettings.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../css/choice-style.css" />

  <script>
    // story lines
    const storyLines = [
      "you kneel. you tilt the bottle toward the dog, as if he were asking for some. he drinks and then, light erupts.",
      "the dog's body lifts from the deck, paws outstretched.",
      "his fur glows gold and red. his body expands.",
      "magic.",
      "he lands with a rumble and he is no longer a dog.",
      "a highland bull. eyes glowing orange. horns holding golden fire. the guardian of old magic. the guardian of the queen."
    ];

    // background image map
    const backgroundMap = {
      0: "../images/dogDrinkin.jpg",
      2: "../images/transformDog.jpg",
      3: "../images/highlandBull.jpg"
    };

    let currentBackground = "";

    // update background based on story index
    function updateBackground(lineIndex) {
      const applicableKey = Object.keys(backgroundMap)
        .map(Number)
        .reverse()
        .find(k => lineIndex >= k);

      const newBackground = backgroundMap[applicableKey];
      if (newBackground && newBackground !== currentBackground) {
        document.querySelector('.background').style.backgroundImage = `url('${newBackground}')`;
        currentBackground = newBackground;
      }
    }

    // expose function globally
    window.updateSceneBackground = updateBackground;
  </script>

  <!-- audio support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script defer src="../js/choice-js.js"></script>
</head>

<body class="fade-in">
  <!-- background image container -->
  <div class="background" style="background-image: url('../images/dogDrinkin.jpg');"></div>

  <main class="scene-wrapper">
    <h1 class="scene-title">a strong companion</h1>

    <!-- narrative and navigation -->
    <div class="narrative-box">
      <button id="prev" class="arrow-btn inside" aria-label="previous line">⬅️</button>
      <section id="typewriter" class="typewriter-container"></section>
      <button id="next" class="arrow-btn inside" aria-label="next line">➡️</button>
    </div>

    <!-- next choice link -->
    <nav id="choices" class="choices" aria-label="choice navigation">
      <a href="../choices/scene10_TheBattle.html" class="choice-button">next</a>
    </nav>
  </main>

  <footer class="site-footer">
    <small>all images are ai generated.</small>
  </footer>

  <script>
    // add fade-out on link click
    document.querySelectorAll('a[href]').forEach(link => {
      const href = link.getAttribute('href');
      if (href && !href.startsWith('#') && !href.startsWith('mailto:') && !href.startsWith('javascript:')) {
        link.addEventListener('click', function (e) {
          e.preventDefault();
          document.body.classList.add('fade-out');
          setTimeout(() => {
            window.location.href = this.href;
          }, 500);
        });
      }
    });
  </script>
</body>

</html>
